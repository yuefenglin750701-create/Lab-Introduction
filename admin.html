<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¦é©—å®¤å¾Œå°ç®¡ç†ç³»çµ± (Admin Dashboard)</title>
    
    <!-- 0. Global Error Handler -->
    <script>
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('Global Error:', msg, error);
            if (msg.indexOf("Script error") > -1) return true;
            return false;
        };
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 1. Database Abstraction Layer -->
    <script>
        window.appId = 'default-app-id';

        const localDB = {
            get: (key) => {
                try { return JSON.parse(localStorage.getItem('smsmp_' + key) || '[]'); } catch (e) { return []; }
            },
            set: (key, data) => {
                try { localStorage.setItem('smsmp_' + key, JSON.stringify(data)); return true; } catch (e) { alert("å„²å­˜ç©ºé–“å·²æ»¿"); return false; }
            }
        };

        window.dbOps = {
            mode: 'LOCAL',
            ready: true,
            signIn: async () => true,
            onAuth: (cb) => { setTimeout(() => cb({ uid: 'local-admin', email: 'admin@local' }), 100); return () => {}; },
            fetch: async (colName) => {
                const data = localDB.get(colName);
                return Array.isArray(data) ? data : [];
            },
            add: async (colName, data) => {
                const list = localDB.get(colName);
                const newItem = { ...data, id: 'loc_' + Date.now(), createdAt: Date.now() };
                list.push(newItem);
                localDB.set(colName, list);
                return newItem;
            },
            update: async (colName, id, data) => {
                const list = localDB.get(colName);
                const idx = list.findIndex(i => i.id === id);
                if (idx !== -1) {
                    list[idx] = { ...list[idx], ...data };
                    localDB.set(colName, list);
                }
            },
            delete: async (colName, id) => {
                const list = localDB.get(colName);
                localDB.set(colName, list.filter(i => i.id !== id));
            },
            batchAdd: async (colName, items) => {
                const list = localDB.get(colName);
                const newItems = items.map((item, idx) => ({
                    ...item,
                    id: 'batch_' + Date.now() + '_' + idx,
                    createdAt: item.createdAt || (Date.now() - idx * 100)
                }));
                localDB.set(colName, [...list, ...newItems]);
            },
            initDefaults: async (defaultData) => {
                for (const [key, items] of Object.entries(defaultData)) {
                    if (localDB.get(key).length === 0) {
                        const newItems = items.map((i, idx) => ({ ...i, id: `init_${idx}`, createdAt: Date.now() - (idx * 1000) }));
                        localDB.set(key, newItems);
                    }
                }
            }
        };
    </script>

    <!-- 2. Firebase SDKs -->
    <script type="module">
        (async () => {
            try {
                if (typeof __firebase_config === 'undefined' || !__firebase_config) throw new Error("No Config");
                
                const { initializeApp } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js");
                const { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js");
                const { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, writeBatch } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js");

                const app = initializeApp(JSON.parse(__firebase_config));
                const auth = getAuth(app);
                const db = getFirestore(app);
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                
                window.dbOps = {
                    mode: 'FIREBASE',
                    ready: true,
                    signIn: async () => {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    },
                    onAuth: (cb) => onAuthStateChanged(auth, cb),
                    fetch: async (colName) => {
                        const colRef = collection(db, 'artifacts', appId, 'public', 'data', colName);
                        const snapshot = await getDocs(colRef);
                        return snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                    },
                    add: async (colName, data) => {
                        const colRef = collection(db, 'artifacts', appId, 'public', 'data', colName);
                        await addDoc(colRef, { ...data, createdAt: data.createdAt || Date.now() });
                    },
                    update: async (colName, id, data) => {
                        const docRef = doc(db, 'artifacts', appId, 'public', 'data', colName, id);
                        await updateDoc(docRef, data);
                    },
                    delete: async (colName, id) => {
                        const docRef = doc(db, 'artifacts', appId, 'public', 'data', colName, id);
                        await deleteDoc(docRef);
                    },
                    batchAdd: async (colName, items) => {
                        const batch = writeBatch(db);
                        const colRef = collection(db, 'artifacts', appId, 'public', 'data', colName);
                        items.forEach((item, idx) => {
                             const docRef = doc(colRef);
                             const data = { ...item, createdAt: item.createdAt || (Date.now() - idx * 100) };
                             batch.set(docRef, data);
                        });
                        await batch.commit();
                    },
                    initDefaults: async (defaultData) => {
                        const batch = writeBatch(db);
                        for (const [key, items] of Object.entries(defaultData)) {
                            const colRef = collection(db, 'artifacts', appId, 'public', 'data', key);
                            const snapshot = await getDocs(colRef);
                            if (snapshot.empty) {
                                items.forEach((item, idx) => {
                                    const docRef = doc(colRef);
                                    batch.set(docRef, { ...item, createdAt: Date.now() - (idx * 1000) });
                                });
                            }
                        }
                        await batch.commit();
                    }
                };
                console.log("ğŸ”¥ Firebase Connected");
            } catch (e) {
                console.warn("âš ï¸ Firebase failed, using LOCAL mode.");
            }
        })();
    </script>
</head>
<body class="bg-gray-100 font-sans text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, Component } = React;

        class ErrorBoundary extends Component {
            constructor(props) { super(props); this.state = { hasError: false }; }
            static getDerivedStateFromError(error) { return { hasError: true }; }
            render() {
                if (this.state.hasError) {
                    return <div className="min-h-screen flex items-center justify-center bg-red-50"><div className="bg-white p-6 rounded shadow text-center text-red-600">ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é‡æ–°æ•´ç†</div></div>;
                }
                return this.props.children;
            }
        }

        const CRED_KEY_USER = 'smsmp_admin_user';
        const CRED_KEY_PASS = 'smsmp_admin_pass';
        const DEFAULT_USER = 'Yflin';
        const DEFAULT_PASS = '0701';

        const getCredentials = () => ({
            username: localStorage.getItem(CRED_KEY_USER) || DEFAULT_USER,
            password: localStorage.getItem(CRED_KEY_PASS) || DEFAULT_PASS
        });

        const updateCredentials = (u, p) => { localStorage.setItem(CRED_KEY_USER, u); localStorage.setItem(CRED_KEY_PASS, p); };

        const defaultData = {
            news: [{ date: "2025-11-06", title: "æ¦®ç²å°ç£ç²¾å¯†å·¥ç¨‹å­¸æœƒ å°ˆé¡Œèˆ‡è«–æ–‡ç ä½³ä½œ", tag: "Award" }],
            projects: [{ type: "government", year: "2025", title: "NSTC-114 è¨ˆç•«", role: "ä¸»æŒäºº" }],
            members: [{ type: 'pi', name: "æ—å²³é‹’", year: "", research: "å‰µæ–°é«˜æ•ˆèƒ½åŠ å·¥" }],
            gallery: [],
            publications: [{ year: "2025", title: "Scalable Real-time Energy Monitoring...", venue: "Sensors" }]
        };

        const TAB_NAMES = {
            news: 'æœ€æ–°æ¶ˆæ¯',
            projects: 'æ­·å¹´è¨ˆç•«',
            members: 'æˆå“¡ç®¡ç†',
            publications: 'ç™¼è¡¨è«–æ–‡',
            gallery: 'ç”Ÿæ´»å¯«çœŸ'
        };

        const FolderIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-16 h-16 text-yellow-400 mb-2 drop-shadow-sm group-hover:scale-110 transition-transform">
                <path d="M19.5 21a3 3 0 0 0 3-3v-4.5a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3V18a3 3 0 0 0 3 3h15ZM1.5 10.146V6a3 3 0 0 1 3-3h5.379a2.25 2.25 0 0 1 1.59.659l2.122 2.121c.14.141.331.22.53.22H19.5a3 3 0 0 1 3 3v1.146A4.483 4.483 0 0 0 19.5 9h-15a4.483 4.483 0 0 0-3 1.146Z" />
            </svg>
        );

        const LoginForm = ({ onLogin }) => {
            const [u, setU] = useState('');
            const [p, setP] = useState('');
            const [err, setErr] = useState('');
            const handleSubmit = (e) => {
                e.preventDefault();
                const creds = getCredentials();
                if (u === creds.username && p === creds.password) onLogin();
                else setErr('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤');
            };
            return (
                <div className="min-h-screen flex items-center justify-center bg-gray-100 p-4">
                    <div className="bg-white p-8 rounded-lg shadow-lg w-full max-w-sm">
                        <h2 className="text-xl font-bold mb-6 text-center">å¾Œå°ç™»å…¥</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <input className="w-full border p-2 rounded" placeholder="å¸³è™Ÿ" value={u} onChange={e=>setU(e.target.value)} required />
                            <input className="w-full border p-2 rounded" type="password" placeholder="å¯†ç¢¼" value={p} onChange={e=>setP(e.target.value)} required />
                            {err && <p className="text-red-500 text-center text-sm">{err}</p>}
                            <button className="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">ç™»å…¥</button>
                        </form>
                    </div>
                </div>
            );
        };

        const EditorModal = ({ activeTab, initData, onSave, onBatchSave, onClose }) => {
            const [formData, setFormData] = useState({});
            const [galleryImages, setGalleryImages] = useState([]);
            const [coverIndex, setCoverIndex] = useState(0);

            useEffect(() => {
                const d = { ...initData };
                if (activeTab === 'members' && !d.type) d.type = 'master';
                if (!d.id) {
                    if (activeTab === 'projects') d.type = 'government';
                    if (activeTab === 'members') d.year = 'ç¢©ä¸€';
                    if (activeTab === 'news') d.tag = 'Activity';
                }
                setFormData(d);
                if (activeTab === 'gallery') {
                    setGalleryImages(d.src ? [{src: d.src, id: 'init'}] : []);
                    setCoverIndex(0);
                }
            }, [initData, activeTab]);

            const handleChange = (e) => setFormData(prev => ({ ...prev, [e.target.name]: e.target.value }));
            
            const handleFiles = (e) => {
                Array.from(e.target.files).forEach(file => {
                    if (file.size > 800 * 1024) { alert('æª”æ¡ˆéå¤§ (Max 800KB)'); return; }
                    const reader = new FileReader();
                    reader.onload = () => {
                        if (activeTab === 'gallery') {
                            setGalleryImages(prev => [...prev, { src: reader.result, id: Math.random() }]);
                        } else {
                            const field = activeTab === 'members' ? 'photo' : 'image';
                            setFormData(prev => ({ ...prev, [field]: reader.result }));
                        }
                    };
                    reader.readAsDataURL(file);
                });
            };

            const handlePaste = (e) => {
                if (activeTab !== 'gallery') return;
                const items = e.clipboardData.items;
                for (let i = 0; i < items.length; i++) {
                    if (items[i].type.indexOf("image") !== -1) {
                        const blob = items[i].getAsFile();
                        const reader = new FileReader();
                        reader.onload = () => setGalleryImages(prev => [...prev, { src: reader.result, id: Math.random() }]);
                        reader.readAsDataURL(blob);
                    }
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (activeTab === 'gallery' && !formData.id && galleryImages.length > 0) {
                    const items = galleryImages.map((img, idx) => {
                        const offset = idx === coverIndex ? 0 : (idx + 1) * 1000;
                        return { ...formData, src: img.src, createdAt: Date.now() - offset };
                    });
                    if(await onBatchSave(items)) onClose();
                } else {
                    if (activeTab === 'gallery' && galleryImages.length > 0) formData.src = galleryImages[0].src;
                    if(await onSave(formData)) onClose();
                }
            };

            const isMember = activeTab === 'members';
            const isGallery = activeTab === 'gallery';
            
            return (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onPaste={handlePaste}>
                    <div className="bg-white rounded-lg shadow-xl w-full max-w-xl max-h-[90vh] overflow-y-auto">
                        <form onSubmit={handleSubmit} className="p-6 space-y-4">
                            <h3 className="text-xl font-bold">{formData.id ? 'ç·¨è¼¯' : 'æ–°å¢'} {isGallery ? '(ç›¸ç°¿æ¨¡å¼)' : ''}</h3>
                            <div>
                                <label className="block text-sm font-bold mb-1">{isMember ? 'å§“å' : 'æ¨™é¡Œ'}</label>
                                <input required name={isMember ? 'name' : 'title'} value={(isMember ? formData.name : formData.title) || ''} onChange={handleChange} className="w-full border p-2 rounded" />
                                {isGallery && <p className="text-xs text-gray-500 mt-1">ç›¸åŒæ¨™é¡Œçš„ç…§ç‰‡æœƒè‡ªå‹•æ­¸é¡ç‚ºåŒä¸€æœ¬ç›¸ç°¿ã€‚</p>}
                            </div>
                            {isMember && (
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-bold mb-1">èº«åˆ†</label>
                                        <select name="type" value={formData.type} onChange={handleChange} className="w-full border p-2 rounded">
                                            <option value="pi">æŒ‡å°æ•™æˆ</option>
                                            <option value="phd">åšå£«ç”Ÿ</option>
                                            <option value="master">ç¢©å£«ç”Ÿ</option>
                                            <option value="alumni">ç•¢æ¥­æ ¡å‹</option>
                                        </select>
                                    </div>
                                    <div>
                                        {formData.type === 'alumni' ? (
                                            <>
                                                <label className="block text-sm font-bold mb-1">ç•¢æ¥­ç´šåˆ¥ (e.g. 110)</label>
                                                <input name="classYear" value={formData.classYear||''} onChange={handleChange} className="w-full border p-2 rounded" placeholder="110" />
                                            </>
                                        ) : (formData.type !== 'pi' && (
                                            <>
                                                <label className="block text-sm font-bold mb-1">å¹´ç´š (e.g. ç¢©ä¸€)</label>
                                                <select name="year" value={formData.year||''} onChange={handleChange} className="w-full border p-2 rounded">
                                                    {["ç¢©ä¸€","ç¢©äºŒ","ç¢©ä¸‰","åšä¸€","åšäºŒ","åšä¸‰","åšå››","åšäº”"].map(y=><option key={y} value={y}>{y}</option>)}
                                                </select>
                                            </>
                                        ))}
                                    </div>
                                </div>
                            )}
                            {activeTab === 'news' && <input type="date" name="date" value={formData.date||''} onChange={handleChange} className="w-full border p-2 rounded" />}
                            {isGallery ? (
                                <div className="border-2 border-dashed p-4 rounded bg-gray-50">
                                    <div className="flex justify-between mb-2">
                                        <label className="font-bold text-sm">ç›¸ç°¿ç…§ç‰‡ (å¤šé¸/è²¼ä¸Š)</label>
                                        <span className="text-xs bg-green-100 text-green-800 px-2 rounded">é»æ“Šè¨­ç‚ºå°é¢</span>
                                    </div>
                                    <input type="file" accept="image/*" multiple onChange={handleFiles} className="mb-2 w-full text-sm" />
                                    <div className="grid grid-cols-4 gap-2">
                                        {galleryImages.map((img, idx) => (
                                            <div key={idx} onClick={() => setCoverIndex(idx)} className={`relative aspect-square cursor-pointer border-2 ${idx===coverIndex ? 'border-green-500' : 'border-transparent'}`}>
                                                <img src={img.src} className="w-full h-full object-cover" />
                                                {idx===coverIndex && <div className="absolute top-0 left-0 bg-green-500 text-white text-[10px] px-1">å°é¢</div>}
                                                <button type="button" onClick={(e)=>{e.stopPropagation();setGalleryImages(prev=>prev.filter((_,i)=>i!==idx))}} className="absolute top-0 right-0 bg-red-500 text-white w-5 h-5 flex items-center justify-center rounded-bl">Ã—</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ) : (
                                ['news', 'members'].includes(activeTab) && (
                                    <div>
                                        <label className="block text-sm font-bold mb-1">åœ–ç‰‡</label>
                                        <input type="file" accept="image/*" onChange={handleFiles} className="w-full border p-2 rounded text-sm" />
                                        {formData[activeTab==='members'?'photo':'image'] && <img src={formData[activeTab==='members'?'photo':'image']} className="h-20 mt-2 border rounded" />}
                                    </div>
                                )
                            )}
                            {!isGallery && !isMember && activeTab !== 'news' && (
                                <>
                                    <input name="role" placeholder="æ“”ä»»è§’è‰² / èªªæ˜" value={formData.role||formData.desc||''} onChange={handleChange} className="w-full border p-2 rounded" />
                                    <input name="year" placeholder="å¹´ä»½" value={formData.year||''} onChange={handleChange} className="w-full border p-2 rounded" />
                                </>
                            )}
                            {isMember && <textarea name="research" placeholder="ç ”ç©¶é ˜åŸŸ / ç°¡ä»‹" value={formData.research||''} onChange={handleChange} className="w-full border p-2 rounded h-20" />}
                            <div className="flex justify-end gap-2 pt-4">
                                <button type="button" onClick={onClose} className="px-4 py-2 border rounded">å–æ¶ˆ</button>
                                <button type="submit" className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">å„²å­˜</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        const AdminApp = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('news');
            const [dataList, setDataList] = useState([]);
            const [loading, setLoading] = useState(false);
            const [viewingAlbum, setViewingAlbum] = useState(null); 
            const [isEditorOpen, setIsEditorOpen] = useState(false);
            const [editItem, setEditItem] = useState({});
            
            const albumGroups = useMemo(() => {
                if (activeTab !== 'gallery') return {};
                const groups = {};
                (dataList || []).forEach(item => {
                    const t = item.title || '(æœªå‘½å)';
                    if (!groups[t]) groups[t] = [];
                    groups[t].push(item);
                });
                return groups;
            }, [dataList, activeTab]);

            const displayList = useMemo(() => {
                if (activeTab === 'gallery' && viewingAlbum) {
                    return (dataList || []).filter(d => (d.title || '(æœªå‘½å)') === viewingAlbum);
                }
                return dataList || [];
            }, [dataList, activeTab, viewingAlbum]);

            useEffect(() => {
                if (isLoggedIn) {
                    const t = setTimeout(() => { if (!user) setUser({ uid: 'fallback' }); }, 3000);
                    window.dbOps.signIn().catch(e => console.warn(e));
                    window.dbOps.onAuth(u => { clearTimeout(t); if(u) setUser(u); });
                    return () => clearTimeout(t);
                }
            }, [isLoggedIn]);

            useEffect(() => { if (user) loadData(); }, [activeTab, user]);

            const loadData = async () => {
                setLoading(true);
                try {
                    const list = await window.dbOps.fetch(activeTab);
                    list.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
                    setDataList(list);
                } catch(e) { console.error(e); }
                setLoading(false);
            };

            const handleSave = async (data) => {
                if (data.id) await window.dbOps.update(activeTab, data.id, data);
                else await window.dbOps.add(activeTab, data);
                loadData();
                return true;
            };

            const handleBatchSave = async (items) => {
                await window.dbOps.batchAdd(activeTab, items);
                loadData();
                return true;
            };

            const handleDelete = async (id) => {
                if (confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) {
                    await window.dbOps.delete(activeTab, id);
                    loadData();
                }
            };

            if (!isLoggedIn) return <LoginForm onLogin={() => setIsLoggedIn(true)} />;
            if (!user) return <div className="min-h-screen flex items-center justify-center text-gray-500">é€£æ¥è³‡æ–™åº«ä¸­...</div>;

            return (
                <div className="min-h-screen flex flex-col md:flex-row">
                    <div className="w-full md:w-64 bg-slate-800 text-white p-6 flex-shrink-0">
                        <h1 className="text-xl font-bold mb-8">å¯¦é©—å®¤å¾Œå°</h1>
                        <nav className="space-y-2">
                            {Object.keys(TAB_NAMES).map(t => (
                                <button key={t} onClick={() => { setActiveTab(t); setViewingAlbum(null); }} className={`w-full text-left px-4 py-2 rounded ${activeTab===t ? 'bg-blue-600' : 'hover:bg-slate-700'}`}>{TAB_NAMES[t]}</button>
                            ))}
                        </nav>
                        <button onClick={() => window.dbOps.initDefaults(defaultData).then(loadData)} className="mt-8 text-xs text-gray-400 hover:text-white">é‡ç½®ç¯„ä¾‹è³‡æ–™</button>
                    </div>
                    
                    <div className="flex-grow p-8 overflow-y-auto">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold flex items-center gap-2">
                                {activeTab === 'gallery' && viewingAlbum && <button onClick={() => setViewingAlbum(null)} className="text-blue-500 hover:underline">â†</button>}
                                {activeTab === 'gallery' && viewingAlbum ? viewingAlbum : TAB_NAMES[activeTab]}
                            </h2>
                            <button onClick={() => { setEditItem(viewingAlbum ? {title: viewingAlbum} : {}); setIsEditorOpen(true); }} className="bg-green-600 text-white px-4 py-2 rounded shadow hover:bg-green-700">+ æ–°å¢</button>
                        </div>

                        {loading ? <p>è¼‰å…¥ä¸­...</p> : (
                            <div className="bg-white rounded shadow p-6">
                                {activeTab === 'gallery' && !viewingAlbum ? (
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        {Object.entries(albumGroups).map(([title, items]) => (
                                            <div key={title} onClick={() => setViewingAlbum(title)} className="border rounded p-4 cursor-pointer hover:bg-blue-50 flex flex-col items-center text-center">
                                                <FolderIcon />
                                                <span className="font-bold">{title}</span>
                                                <span className="text-xs text-gray-500">{items.length} å¼µ</span>
                                            </div>
                                        ))}
                                        {Object.keys(albumGroups).length === 0 && <p className="col-span-full text-center text-gray-400">å°šç„¡ç›¸ç°¿</p>}
                                    </div>
                                ) : (
                                    <table className="w-full text-left">
                                        <thead><tr className="border-b text-gray-500"><th className="p-3">æ¨™é¡Œ / å…§å®¹</th><th className="p-3">æ“ä½œ</th></tr></thead>
                                        <tbody>
                                            {displayList.map(item => (
                                                <tr key={item.id} className="border-b hover:bg-gray-50">
                                                    <td className="p-3">
                                                        <div className="font-bold">{item.title || item.name}</div>
                                                        <div className="text-xs text-gray-500 truncate max-w-md">{item.desc || item.research}</div>
                                                        {(item.src || item.photo || item.image) && <span className="text-[10px] bg-green-100 text-green-800 px-1 rounded">IMG</span>}
                                                    </td>
                                                    <td className="p-3">
                                                        <button onClick={() => { setEditItem(item); setIsEditorOpen(true); }} className="text-blue-600 mr-3">ç·¨è¼¯</button>
                                                        <button onClick={() => handleDelete(item.id)} className="text-red-600">åˆªé™¤</button>
                                                    </td>
                                                </tr>
                                            ))}
                                            {displayList.length === 0 && <tr><td colSpan="2" className="p-4 text-center text-gray-400">ç„¡è³‡æ–™</td></tr>}
                                        </tbody>
                                    </table>
                                )}
                            </div>
                        )}
                    </div>
                    
                    {isEditorOpen && <EditorModal activeTab={activeTab} initData={editItem} onSave={handleSave} onBatchSave={handleBatchSave} onClose={() => setIsEditorOpen(false)} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ErrorBoundary><AdminApp /></ErrorBoundary>);
    </script>
</body>
</html>